# Keymaps — navigation, font tweaks, kittens, and theming

# Primary modifier (Linux default)
kitty_mod ctrl+shift

# Window / tab navigation
# Shell integration helpers (official docs: https://sw.kovidgoyal.net/kitty/shell-integration/)
mouse_map right press ungrabbed mouse_select_command_output
map f1 show_last_visited_command_output

map kitty_mod+enter new_window_with_cwd
map kitty_mod+n     new_os_window_with_cwd
map kitty_mod+t     new_tab_with_cwd
map kitty_mod+w     close_window
# Close current pane by sending Ctrl-D to the foreground process
map ctrl+shift+d send_text all \x04
map kitty_mod+]     next_window
map kitty_mod+[     previous_window
# AZERTY-friendly alternatives (bracket keys require AltGr on AZERTY)
map ctrl+shift+alt+n next_window       # N = Next
map ctrl+shift+alt+p previous_window   # P = Previous
map kitty_mod+right next_tab
map kitty_mod+left  previous_tab
map kitty_mod+q     close_tab
map kitty_mod+period move_tab_forward
map kitty_mod+comma  move_tab_backward
map ctrl+shift+alt+e  set_tab_title
# Intelligent tab renaming (under the kitty_mod+E chord family)
map kitty_mod+e>t launch --type=background --title="Smart Tab Title" python3 ~/.config/kitty/scripts/smart_tab_title.py
map kitty_mod+r      start_resizing_window

# Move window in stack
map kitty_mod+f      move_window_forward
map kitty_mod+b      move_window_backward
# move_window_to_top action doesn't exist in Kitty 0.42.2 - commented out
# map kitty_mod+grave  move_window_to_top
# AZERTY alternative: Use first_window instead (focuses first window)
map ctrl+shift+alt+y first_window  # Y = Jump to first window

# Direct split creation
map ctrl+shift+alt+minus     launch --location=hsplit --cwd=current
map ctrl+shift+alt+backslash launch --location=vsplit --cwd=current

# Focus specific windows by index
map kitty_mod+1 first_window
map kitty_mod+2 second_window
map kitty_mod+3 third_window
map kitty_mod+4 fourth_window
map kitty_mod+5 fifth_window
map kitty_mod+6 sixth_window
map kitty_mod+7 seventh_window
map kitty_mod+8 eighth_window
map kitty_mod+9 ninth_window
map kitty_mod+0 tenth_window

# Font size adjustments
map kitty_mod+equal     change_font_size all +2.0
map kitty_mod+minus     change_font_size all -2.0
map kitty_mod+backspace change_font_size all 0

# Scrolling
map kitty_mod+k        scroll_line_up
map kitty_mod+j        scroll_line_down
map kitty_mod+page_up  scroll_page_up
map kitty_mod+page_down scroll_page_down
map kitty_mod+home     scroll_home
map kitty_mod+end      scroll_end
map kitty_mod+h        show_scrollback
map ctrl+shift+alt+z    scroll_to_prompt -1
map ctrl+shift+alt+x    scroll_to_prompt 1

# Config / tools
map kitty_mod+F12 edit_config_file
map ctrl+shift+f2 edit_config_file
map kitty_mod+F5  load_config_file
map kitty_mod+F2  launch --type=overlay --title="Toggle Low-Latency" bash -lc '~/.config/kitty/scripts/toggle_perf_profile.sh'
map kitty_mod+F3  launch --type=overlay --title="Toggle Focus-Follows-Mouse" bash -lc '~/.config/kitty/scripts/toggle_focus_follows_mouse.sh'
map kitty_mod+F4  launch --type=overlay --title="Toggle Tmux Passthrough" bash -lc '~/.config/kitty/scripts/toggle_tmux_passthrough.sh'
map kitty_mod+F6  launch --type=overlay --title="Toggle Window Dimming" bash -lc '~/.config/kitty/scripts/toggle_window_dimming.sh'
map kitty_mod+F9  launch --type=overlay --title="Help" python3 ~/.config/kitty/kittens/help_center.py
map kitty_mod+ctrl+shift+semicolon launch --type=background --cwd=current bash -lc '~/.config/kitty/scripts/kitty-rc.sh launch --title "Logs" --match "title:^Logs" --type window --command "journalctl -f --unit sshd"'
# Explicit config debugger (kept off kitty_mod keys to avoid fullscreen conflict)
map ctrl+alt+f11 debug_config
map ctrl+shift+f6 debug_config


# Clipboard convenience
map kitty_mod+c copy_to_clipboard
map kitty_mod+v paste_from_clipboard
map shift+insert paste_from_selection
map ctrl+shift+alt+v launch --type=overlay --title="Clipboard History" python3 ~/.config/kitty/kittens/clipboard_history.py

# Hints and utilities - enhanced productivity shortcuts
map kitty_mod+e open_url_with_hints

# Direct access to new features (non-chord alternatives for testing)
map ctrl+shift+alt+t launch --type=overlay --title="Theme Picker" python3 ~/.config/kitty/kittens/theme_picker.py
map ctrl+shift+alt+g launch --type=overlay --title="Layout Presets" python3 ~/.config/kitty/kittens/layout_presets.py
map ctrl+shift+alt+c launch --type=overlay --title="Command Palette" python3 ~/.config/kitty/kittens/command_palette.py
map kitty_mod+e>f kitten hints --type path --program -
map kitty_mod+e>l kitten hints --type line --program -
map kitty_mod+e>w kitten hints --type word --program -
map kitty_mod+e>h kitten hints --type hash --program -

# Enhanced hints for development workflow
map kitty_mod+e>e kitten hints --type path --program "code"
map kitty_mod+e>n kitten hints --type linenum --program "code --goto"
map kitty_mod+e>c kitten hints --type path --program "cp {} ."
map kitty_mod+e>i kitten hints --type path --program "kitten icat"
map kitty_mod+e>o launch --type=overlay --title="E Chord Cheatsheet" bash -lc '~/.config/kitty/scripts/e_chord_cheatsheet.sh'

# Quick image viewing from hints
map kitty_mod+i kitten hints --type path --program "kitten icat" --hints-offset=0

map kitty_mod+u kitten unicode_input
map kitty_mod+escape kitty_shell window

map kitty_mod+p>c launch --type=overlay --title="Palette" python3 ~/.config/kitty/kittens/command_palette.py
map kitty_mod+p>t launch --type=overlay --title="Theme Picker" python3 ~/.config/kitty/kittens/theme_picker.py
map kitty_mod+p>g launch --type=overlay --title="Layout Presets" python3 ~/.config/kitty/kittens/layout_presets.py
map kitty_mod+p>s launch --type=overlay --title="Save Session" bash -lc '~/.config/kitty/scripts/session_snapshot.sh'
map kitty_mod+p>r launch --type=overlay --title="Restore Session" bash -lc '~/.config/kitty/scripts/session_snapshot.sh --restore'
map kitty_mod+p>l launch --type=overlay --title="Save Startup Session" bash -lc '~/.config/kitty/scripts/session_snapshot.sh --startup'
map kitty_mod+p>w launch --type=background --title="Watch Reload" bash -lc '~/.config/kitty/scripts/watch-reload.sh toggle'
map kitty_mod+p>h launch --type=overlay --title="SSH Hosts" bash -lc '~/.config/kitty/scripts/ssh_picker.sh'
map kitty_mod+p>shift+h launch --type=overlay --title="Restore SSH Session" bash -lc '~/.config/kitty/scripts/ssh_restore.sh'
map kitty_mod+p>k launch --type=overlay --title="Keymap Check" bash -lc '~/.config/kitty/scripts/check-keymaps.sh | less -R'
map kitty_mod+p>d launch --type=overlay --title="Deps Check" bash -lc '~/.config/kitty/scripts/check_deps.sh | less -R'
map kitty_mod+p>b launch --type=overlay --title="Battery Saver" bash -lc '~/.config/kitty/scripts/toggle_battery_saver.sh'
map kitty_mod+p>f launch --type=overlay --title="Auto Scale" bash -lc '~/.config/kitty/scripts/auto_scale.sh'
map kitty_mod+p>shift+f launch --type=overlay --title="Toggle Font Scaling" bash -lc '~/.config/kitty/scripts/toggle_font_scaling.sh'
map kitty_mod+p>o launch --type=overlay --title="P Chord Cheatsheet" bash -lc '~/.config/kitty/scripts/p_chord_cheatsheet.sh'
map kitty_mod+p>question launch --type=overlay --title="Chord Binding Test" bash -lc '~/.config/kitty/scripts/test_chord_bindings.sh'

map kitty_mod+p>u launch --type=overlay --title="Transfer (download)" bash -lc '~/.config/kitty/scripts/transfer_helper.sh download'
map kitty_mod+p>y launch --type=overlay --title="Transfer (upload)" bash -lc '~/.config/kitty/scripts/transfer_helper.sh upload'
map kitty_mod+p>m launch --type=background --title="Status Panel" bash -lc 'kitty +kitten panel --single-instance --edge=bottom --lines=8 --title "Status Panel" --start-command "htop"'
map ctrl+shift+alt+m launch --allow-remote-control kitty +kitten broadcast --match-tab state:focused

# Clear
map kitty_mod+delete clear_terminal reset active

# Global fullscreen/maximize
map kitty_mod+f11 toggle_fullscreen
map kitty_mod+f10 toggle_maximized


# Quick theme switching (safe kitten apply)

# Background opacity controls (official config pattern - AZERTY compatible)
# Usage: Press Ctrl+Shift+A, then: M (more), L (less), 1 (opaque), D (default)
map kitty_mod+a>m set_background_opacity +0.1
map kitty_mod+a>l set_background_opacity -0.1
map kitty_mod+a>1 set_background_opacity 1
map kitty_mod+a>d set_background_opacity default

# Background management shortcut
map ctrl+shift+alt+slash launch --type=overlay --title="P Chord Cheatsheet" bash -lc '~/.config/kitty/scripts/p_chord_cheatsheet.sh'
map ctrl+shift+alt+o launch --type=overlay --title="E Chord Cheatsheet" bash -lc '~/.config/kitty/scripts/e_chord_cheatsheet.sh'

# Layout cycling and directional focus
map kitty_mod+space next_layout
# Directional window focus (using explicit modifiers to avoid conflict with scrolling shortcuts)
map ctrl+shift+alt+h neighboring_window left
map ctrl+shift+alt+j neighboring_window down
map ctrl+shift+alt+k neighboring_window up
map ctrl+shift+alt+l neighboring_window right
# Neon Pulse moved to demo mode profile

# Swap windows (disabled - swap_with_window is not a valid Kitty action)
# map kitty_mod+ctrl+shift+h swap_with_window left
# map kitty_mod+ctrl+shift+j swap_with_window down
# map kitty_mod+ctrl+shift+k swap_with_window up
# map kitty_mod+ctrl+shift+l swap_with_window right

# UI toggles (changed from ctrl+shift+alt+t due to conflict with theme picker)
map ctrl+shift+alt+b toggle_tab_bar

# Split resizing (keyboard) — kitty has no mouse-drag resize for splits
map ctrl+shift+alt+left  resize_window narrower
map ctrl+shift+alt+right resize_window wider
map ctrl+shift+alt+up    resize_window taller
map ctrl+shift+alt+down  resize_window shorter
map ctrl+shift+alt+backspace resize_window reset
